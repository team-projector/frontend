# Introduction

Team projector supports i18n. Currently we have translations for:
* English (USA) **default**
* Russian

# Workflow
To add translations you need to perform the some steps.

## Step 1 - adding translation labels with ids

In your components templates add `i18n-*` attributes:
```html
<jnt-label i18n-label="@@label.hello_world"
    label="Hello world!">
</jnt-label>

<h1 i18n="@@label.hello_world">Hello world!</h1>
```

In your components classes you should use:
```typescript
const message = $localize`:@@label.hello_world:Hello world!`}
```

We use special **labels** naming conventions `<label_type>.<snake_case_label>`:
* `label.hello_wourld` - words, small phrases
* `message.mandatory_field` - sentences
* `actions.user_signin` - verbs, what it can be clicked, moved, etc.

## Step 2 - generating translation template `*.xlf` file

Run command in terminal
```
ng xi18n
```
It will make `messages.xlf` file at `src/locale` folder with text for translation based on all **i18n** ids in project.
Open you translation template file, you will see blocks likes this one:
```xml
<trans-unit id="label.hello_world" datatype="html">
  <source>Hello world!</source>
  ...
</trans-unit>
```
## Step 3 - creating translation files

You can create translation files by **xliffmerge** script which allows you to create new translation files for language you need from translation template and merge there your updates or changes in i18n. You can read more about this script [here](https://github.com/martinroob/ngx-i18nsupport/tree/master/projects/xliffmerge).

For using this script install `ngx-i18nsupport` by command:

`npm install -g ngx-i18nsupport`

You can then integrate the script in your angular i18n workflow, typically in the `package.json` script section:
```json
"scripts": [
  ...
  "extract-i18n": "ng xi18n --output-path src/locale && xliffmerge --profile xliffmerge.json en de"
 ]
```
And then you need to add `xliffmere` configuration to `package.json`:
```json
{
  "xliffmergeOptions": {
    "srcDir": "src/locale",
    "genDir": "src/locale",
    "i18nFile": "messages.xlf",
    "i18nBaseFile": "messages",
    "i18nFormat": "xlf",
    "encoding": "UTF-8",
    "defaultLanguage": "en",
    "languages": ["en", "de"],
    "removeUnusedIds": false,
    "supportNgxTranslate": false,
    "ngxTranslateExtractionPattern": "@@|ngx-translate",
    "useSourceAsTarget": true,
    "targetPraefix": "",
    "targetSuffix": "",
    "beautifyOutput": true,
    "preserveOrder": true,
    "allowIdChange": false,
    "autotranslate": false,
    "apikey": "",
    "apikeyfile": "",
    "verbose": false,
    "quiet": false
  }
}
```
You can change `"languages": ["en", "de"],` to you language for auto creating/merging translation file by runing `xliffmerge` without language option

Now you can run command for creating translation file for you language. Example for `de`:

`xliffmerge de`

It will make copy of `messages.xlf` file  at `src/locale` renamed to `messages.de.xlf` with additional tag `<target>` near every `<source>` tag which contains source text for translation and marked by ` state="new"`.
```xml
<trans-unit id="label.hello_world" datatype="html">
  <source>Hello world!</source>
  <target state="new">Hello world!</target>
  ...
</trans-unit>
```
So now we have 2 files at `src/locale`. `messages.xlf` and `messages.de.xlf`
You can make more translation files by using command `xliffmerge` with other language options

## Step 4 - translation text

Translate text inside `<target>` to your language 
```xml
<trans-unit id="label.hello_world" datatype="html">
  <source>Wellcome i18n!</source>
  <target>Willkommen i18n!</target>
  ...
</trans-unit>
```
Translate the other text nodes the same way. So when you will compile you app with language option you need - all text in `<source>` will be replaced to `<target>` text from choosen language translation file

## Step 5 - configuration angular.json

Add your language configuration to `angular.json / locales`. Example for `de` language:
```json
  {
  "projects": {
    "yourProject": {
      "i18n": {
        "sourceLocale": {
          "code": "en",
          "baseHref": "/en/"
        },
        "locales": {
          "de": {
            "translation": "src/locale/messages.de.xlf",
            "baseHref": "/de/"
          }
        }
      },
      ...
    }
  }
}
```
So now you can run your app with you language

## Step 6 - updating and merging changes

If you add new elements which you need to translate - you need to add it to you translation template file `messages.xlf` first by command `ng xi18n --output-path locale` which will rewrite this file. Then you need to merge translation blocks to your translation file by using `xliffmerge de` which will update `xliffmerge.de.xlf` file with adding new blocks contains `<target>` tags marked `state="new"` which you need to translate
```xml
<trans-unit id="label.some_text" datatype="html">
  <source>Some text</source>
  <target state="new">Some text</target>
  ...
</trans-unit>
```

## Step 7 - building multilanguage app

After preparing translation of project you need to add your language configuration to `angular.json` here (example for `de` ):
```json
"i18n": {
        "sourceLocale": {
          "code": "en",
          "baseHref": "/en/"
        },
        "locales": {
          "de": {
            "translation": "src/locale/messages.de.xlf",
            "baseHref": "/de/"
          }
        }
      },
```
Now you can build project in multilanguage by using

`ng build --prod --localize`

It will make files at `dist` folders for every language with translated files. `dist/en` for default and `dist/de` for `de` language 
