<jnt-form [formGroup]="form">
  <jnt-stack [align]="ui.align.stretch" [gutter]="ui.gutter.big">
    <app-metrics-type formControlName="metric" metrics></app-metrics-type>
    <jnt-row>
      <jnt-col [tablet]="12" [wide]="7">
        <app-team-calendar formControlName="filter"
                           [metric]="metric.value"
                           [team]="team"></app-team-calendar>
      </jnt-col>
      <jnt-col [tablet]="12" [wide]="5">
        <jnt-chart formControlName="project"
                   title="Opened project"
                   metric="Hours"
                   i18n-title="@@label.opened_project"
                   i18n-metric="@@label.hours"
                   keyField="id"
                   [widthMark]="50"
                   (selected)="project = $event">
          <jnt-chart-indicator *ngFor="let p of summary.first?.projects;let i = index"
                               [data]="p.project"
                               [titleTemplate]="titleTemplate"
                               [value]="p.issues.percentage * 100"
                               [label]="p.issues.remains  | duration:durationFormat.short"
                               [color]="colors[i % colors.length]">
            <ng-template #titleTemplate>
              <ng-container *ngIf="p.project.group">{{p.project.group.title}} /</ng-container>
              {{p.project.title}}
              <jnt-stack *ngIf="p.project.milestones as m" milestone
                         [orientation]="ui.orientation.horizontal"
                         [gutter]="ui.gutter.tiny"
                         [align]="ui.align.center">
                <jnt-link [source]="m.glUrl" [title]="m.title"
                          target="_blank"></jnt-link>
                <jnt-label *ngIf="m.dueDate" [label]="m.dueDate | dueDate"
                           [color]="m.problems?.includes(milestoneProblem.overDueDate) ?  ui.color.red : ui.color.paleNavy"></jnt-label>
              </jnt-stack>
            </ng-template>
          </jnt-chart-indicator>
        </jnt-chart>
      </jnt-col>
    </jnt-row>

    <jnt-stack [orientation]="ui.orientation.horizontal">

      <jnt-filter [selected]="!!filter.value.user"
                  (clear)="filter.patchValue({user: null, dueDate: filter.value.dueDate})"
                  placeholder="Pick a user"
                  [icon]="ui.icons.user">
        <ng-template #filterContentTemplate>
          <jnt-stack [orientation]="ui.orientation.horizontal"
                     [gutter]="ui.gutter.small"
                     [align]="ui.align.center">
            <jnt-avatar [image]="filter.value.user?.icon"
                        [size]="ui.size.tiny"></jnt-avatar>
            <span>{{filter.value.user?.name}}</span>
          </jnt-stack>
        </ng-template>
      </jnt-filter>
      <jnt-filter [selected]="!!filter.value.dueDate"
                  placeholder="Pick a due date"
                  [icon]="ui.icons.calendar"
                  (clear)="filter.patchValue({user: filter.value.user, dueDate: null})">
        <ng-template #filterContentTemplate>
          <jnt-stack [orientation]="ui.orientation.horizontal" [gutter]="ui.gutter.small">
            <jnt-icon [icon]="ui.icons.calendar"></jnt-icon>
            <span>{{filter.value.dueDate | date}}</span>
          </jnt-stack>
        </ng-template>
      </jnt-filter>

      <jnt-filter [control]="projectControl"
                  placeholder="Pick a project"
                  [icon]="ui.icons.poop">
        <ng-template #filterContentTemplate>
          <jnt-icon [icon]="ui.icons.project"></jnt-icon>
          <div>
            {{project.title}}<br>
            <small>{{project.group?.fullTitle}}</small>
          </div>
        </ng-template>
      </jnt-filter>

    </jnt-stack>

    <jnt-menu>
      <jnt-menu-item [link]="['issues']"
                     title="Issues"
                     i18n-title="@@action.issues">
        <jnt-badge *ngIf="summary?.second?.issues.count"
                   [value]="summary?.second?.issues.count"
                   [color]="ui.color.green"></jnt-badge>
        <jnt-badge *ngIf="summary?.second?.issues.problemsCount"
                   [value]="summary?.second?.issues.problemsCount"
                   [color]="ui.color.red"></jnt-badge>
      </jnt-menu-item>
      <jnt-menu-item [link]="['merge-requests']"
                     title="Merge Requests"
                     i18n-title="@@action.merge_requests">
        <jnt-badge *ngIf="summary?.second?.mergeRequests.count"
                   [value]="summary?.second?.mergeRequests.count"
                   [color]="ui.color.red"></jnt-badge>
      </jnt-menu-item>
      <jnt-menu-item [link]="['time-expenses']"
                     title="Time Expenses"
                     i18n-title="@@action.time_expenses">
        <jnt-badge
          *ngIf="(filter.value.user || filter.value.dueDate || projectControl.value) && summary?.second?.spentTimes.spent"
          [value]="summary?.second?.spentTimes.spent | duration"
          [color]="ui.color.purple"></jnt-badge>
        <jnt-badge *ngIf="summary?.second?.spentTimes.openedSpent"
                   [text]="summary?.second?.spentTimes.openedSpent | duration"
                   [color]="ui.color.green"></jnt-badge>
      </jnt-menu-item>
    </jnt-menu>
    <router-outlet (activate)="onActivate($event)"></router-outlet>
  </jnt-stack>
</jnt-form>
