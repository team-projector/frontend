<jnt-stack>
  <jnt-form [formGroup]="form">
    <jnt-stack>
      <jnt-stack presentations [type]="ui.stack.type.horizontal">
        <app-metrics-type formControlName="metric"></app-metrics-type>
      </jnt-stack>
      <jnt-stack [type]="ui.stack.type.horizontal" [gutter]="ui.stack.gutter.large">
        <jnt-stack>
          <app-team-calendar formControlName="filter" [metric]="metric.value" [team]="team"></app-team-calendar>
          <jnt-stack [type]="ui.stack.type.horizontal">
            <div filter [attr.active]="!!filter.value.user">
              <ng-container *ngIf="filter.value.user;else noFilterUser">
                <jnt-avatar avatar [image]="filter.value.user.avatar"
                            [size]="ui.sizes.tiny"></jnt-avatar>
                {{filter.value.user.name}}
                <jnt-button reset [scheme]="ui.schemes.secondary"
                            [size]="ui.sizes.tiny"
                            [icon]="ui.icons.close"
                            (click)="filter.patchValue({user: null, dueDate: filter.value.dueDate})"></jnt-button>
              </ng-container>
              <ng-template #noFilterUser>
                <jnt-icon icon [icon]="ui.icons.user"></jnt-icon>
                Pick a user
              </ng-template>
            </div>
            <div filter [attr.active]="!!filter.value.dueDate">
              <ng-container *ngIf="filter.value.dueDate;else noFilterDueDate">
                <jnt-icon icon [icon]="ui.icons.calendar"></jnt-icon>
                {{filter.value.dueDate | date}}
                <jnt-button reset [scheme]="ui.schemes.secondary"
                            [size]="ui.sizes.tiny"
                            [icon]="ui.icons.close"
                            (click)="filter.patchValue({user: filter.value.user,  dueDate: null})"></jnt-button>
              </ng-container>
              <ng-template #noFilterDueDate>
                <jnt-icon icon [icon]="ui.icons.calendar"></jnt-icon>
                Pick a due date
              </ng-template>
            </div>
            <div filter [attr.active]="!!project.value">
              <ng-container *ngIf="!!project.value;else noFilterProject">
                <jnt-icon icon [icon]="ui.icons.project"></jnt-icon>
                <div>
                  {{project.value.title}}<br>
                  <small>{{project.value.group?.fullTitle}}</small>
                </div>
                <jnt-button reset [scheme]="ui.schemes.secondary"
                            [size]="ui.sizes.tiny"
                            [icon]="ui.icons.close"
                            (click)="project.patchValue(null)"></jnt-button>
              </ng-container>
              <ng-template #noFilterProject>
                <jnt-icon icon [icon]="ui.icons.project"></jnt-icon>
                Pick a project
              </ng-template>
            </div>
          </jnt-stack>
          <jnt-menu>
            <jnt-menu-item [link]="['issues']" title="Issues">
              <jnt-badge *ngIf="summary?.second?.issues.count"
                         [count]="summary?.second?.issues.count"
                         [color]="ui.colors.green"></jnt-badge>
              <jnt-badge *ngIf="summary?.second?.issues.problemsCount"
                         [count]="summary?.second?.issues.problemsCount"
                         [color]="ui.colors.red"></jnt-badge>
            </jnt-menu-item>
            <jnt-menu-item [link]="['merge-requests']" title="Merge Requests">
              <jnt-badge *ngIf="summary?.second?.mergeRequests.count"
                         [count]="summary?.second?.mergeRequests.count"
                         [color]="ui.colors.green"></jnt-badge>
            </jnt-menu-item>
            <jnt-menu-item [link]="['time-expenses']" title="Time Expenses">
              <jnt-badge
                *ngIf="(filter.value.user || filter.value.dueDate || project.value) && summary?.second?.spentTimes.spent"
                [count]="summary?.second?.spentTimes.spent | duration"
                [color]="ui.colors.purple"></jnt-badge>
              <jnt-badge *ngIf="summary?.second?.spentTimes.openedSpent"
                         [count]="summary?.second?.spentTimes.openedSpent | duration"
                         [color]="ui.colors.green"></jnt-badge>
            </jnt-menu-item>
          </jnt-menu>
          <router-outlet></router-outlet>
        </jnt-stack>
        <jnt-chart formControlName="project" title="Opened project" metric="Hours">
          <jnt-chart-indicator *ngFor="let p of summary.first?.projects;let i = index"
                               [data]="p.project"
                               [value]="p.issues.percentage * 100"
                               [label]="p.issues.remains  | duration:durationFormat.short"
                               [color]="colors[i % colors.length]">
            <ng-template #titleTemplate>
              <div project>
                <ng-container *ngIf="p.project.group">{{p.project.group.title}} /</ng-container>
                {{p.project.title}}
              </div>
              <ul milestones>
                <li *ngFor="let m of p.project.milestones">
                  <jnt-stack [type]="ui.stack.type.horizontal"
                             [gutter]="ui.stack.gutter.tiny"
                             [align]="ui.flex.align.center">
                    <jnt-link [source]="m.glUrl" [title]="m.title"></jnt-link>
                    <jnt-label *ngIf="m.dueDate" [label]="m.dueDate | dueDate"
                               [color]="m.problems?.includes(milestoneProblem.overDueDate) ?  ui.colors.red : ui.colors.gray500"></jnt-label>
                  </jnt-stack>
                </li>
              </ul>
            </ng-template>
          </jnt-chart-indicator>
        </jnt-chart>
      </jnt-stack>
    </jnt-stack>
  </jnt-form>

</jnt-stack>
